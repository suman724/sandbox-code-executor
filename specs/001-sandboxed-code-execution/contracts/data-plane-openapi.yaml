openapi: 3.0.3
info:
  title: Sandboxed Code Execution Data Plane API
  version: 0.1.0
servers:
  - url: http://sandbox-runner.internal
paths:
  /runs:
    post:
      summary: Start a sandbox run
      description: Invoked by the control plane to provision and execute a sandbox.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunCreate"
      responses:
        "202":
          description: Run accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Run"
  /runs/{runId}:
    get:
      summary: Get run status
      parameters:
        - name: runId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Run details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Run"
  /runs/{runId}/terminate:
    post:
      summary: Terminate a run
      parameters:
        - name: runId
          in: path
          required: true
          schema:
            type: string
      responses:
        "202":
          description: Termination accepted
  /sessions:
    post:
      summary: Start a session runtime
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SessionCreate"
      responses:
        "202":
          description: Session accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Session"
  /sessions/{sessionId}/steps:
    post:
      summary: Execute a session step
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SessionStepCreate"
      responses:
        "202":
          description: Step accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionStepResponse"
  /sessions/{sessionId}/terminate:
    post:
      summary: Terminate a session runtime
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        "202":
          description: Termination accepted
components:
  schemas:
    RunCreate:
      type: object
      required: [jobId, policyId, language, code, workspaceRef]
      properties:
        jobId:
          type: string
        policyId:
          type: string
        language:
          type: string
        code:
          type: string
        workspaceRef:
          type: string
    Run:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        exitStatus:
          type: integer
        outputRef:
          type: string
        errorRef:
          type: string
        artifactRefs:
          type: array
          items:
            type: string
    SessionCreate:
      type: object
      required: [sessionId, policyId, workspaceRef]
      properties:
        sessionId:
          type: string
        policyId:
          type: string
        workspaceRef:
          type: string
        runtime:
          type: string
    Session:
      type: object
      properties:
        id:
          type: string
        runtimeId:
          type: string
        status:
          type: string
    SessionStepCreate:
      type: object
      required: [command]
      properties:
        command:
          type: string
    SessionStepResponse:
      type: object
      properties:
        status:
          type: string
        stdout:
          type: string
        stderr:
          type: string
